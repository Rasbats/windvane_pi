language: cpp
matrix:
  include:
  - dist: trusty
    compiler: gcc
  - os: osx
    compiler: clang
install:
- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get -qq update; sudo apt-get
  install libwxgtk3.0-dev libwxgtk3.0-0 libgps-dev libglu1-mesa-dev libgtk2.0-dev
  libbz2-dev libtinyxml-dev; sudo apt-get install libexpat1-dev libcairo2-dev; sudo
  apt-get install rpm; fi
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install cairo libexif xz libarchive;
  wget http://opencpn.navnux.org/build_deps/wx312_opencpn50_macos109.tar.xz; tar xJf
  wx312_opencpn50_macos109.tar.xz -C /tmp; export PATH="/usr/local/opt/gettext/bin:$PATH";
  echo 'export PATH="/usr/local/opt/gettext/bin:$PATH"' >> ~/.bash_profile; wget http://opencpn.navnux.org/build_deps/Packages.dmg;
  hdiutil attach Packages.dmg; sudo installer -pkg "/Volumes/Packages 1.2.5/Install
  Packages.pkg" -target "/"; fi
script:
- if [[ "${COVERITY_SCAN_BRANCH}" == 1 ]]; then echo "Don't build on coverty_scan
  branch."; exit 0; fi
- mkdir build && cd build
- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then cmake -DCMAKE_BUILD_TYPE=Release ../
  && make -sj2 && sudo make package; fi
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then cmake -DwxWidgets_CONFIG_EXECUTABLE=/tmp/wx312_opencpn50_macos109/bin/wx-config
  -DwxWidgets_CONFIG_OPTIONS="--prefix=/tmp/wx312_opencpn50_macos109" -DCMAKE_INSTALL_PREFIX=/tmp/opencpn
  -DCMAKE_OSX_DEPLOYMENT_TARGET=10.9 .. && make -sj2 && make create-pkg; fi
- ls -l;
notifications:
  email: false
git:
  depth: 10
before_install:
- if [ "$CXX" = "g++" ]; then export CXX="g++-6" CC="gcc-6"; fi
- if [ "${#OAUTH_ACCESS_TOKEN}" != 0 ]; then (echo OAUTH_ACCESS_TOKEN=${OAUTH_ACCESS_TOKEN}
  > ~/.dropbox_uploader); fi
addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - gcc-6
    - g++-6
deploy:
  - provider: launchpad
    slug: "~jonsgough/windvane/+git/windvane_pi"
    oauth_token_secret:
        secure: "sXYyMad09GEvdH8MRYx89wvJPwNlCPq1F785imjVKU69+eaKZXHFIDzfD88J8HbG/ZTGOpOF39pQ/zMhJQn34z1KA9/uDQ3H7p1jznSYa3KrDPldpQOk/eqZ9UF1pjOMw5Rf/PdBCHetyJlyMB0c4OMNVTurTaAQo5N9OxouylxhkUqflBQizHsq6aGn8xb0UVFLLDDckXokfvhiUADgcbkCGrLG4JKeMn4CsVqnpLnj6DQNMJb6nXGKqJVP9ujDGtztv0nEhhpousfG5rvd3cC4Ndh7sQCoShuGVCb3HbhSbOT28Xrrxzxn3xR1re7UJzEnNWUVXQhOV/fgb6BZkQdkOADsSGUHqgT+9Auem6BWPYP+W8VMkSckCbxoq57Hp15RdJCax+FKG0Qiq1EWtsB8/zjEs4iexYD12l2sf59E+rGgR+YjSlTd4MPqzxP1ZB7/aQbiKASv0DalZsytsTkImuWcd1GzeKMU9rAbw7JpD/6KEFLRyJ4yNXlA2Pfj1nXdDTvqRg3bToD3wFhfPBC2DIXaiUtkIB9e3a8EVI/HgCy+XY1oJS//gKaT4OxsNXpi0nHx2o6a/Lpvzv/zWLsxrmKVFcPenl/E699hlIRiCd3fuhv/IwN9mfHSULzicsSHi9bPzicTkRrXeGzEhUM3cbZaeCANw/NuiU9W4xk="
    oauth_token_secret:
        secure: "i/p/vUWXCb6WrxTT5DIRXzPrHRSoQ3GeENMuCFrD7yGZyaq236LxAsAj0ggny4JZRqli57zDWINkwGJtC5tY7fXl3yO8R5Id/MeS8Tp21Ibn9yDIKuN1+ozq6YmwuqqoQ+y3jJIFs53OIe+d8n2/ItB5hFJu7muBGWLFAq0sKJoGsOculZzSajDLb1JAyHyX49gAWrVFe//JnAR+Hd+yFDKgVcJyKi5G7L1laQHGHrpdV2/7qhWxkqYljqV9gitoF0X5m4QWzgUWoappfV5aAHoowj9G29DEN9X6Z38CM1mpVGzAl3tuSvExGp00t3QQVXJNZUeZx+3Abw7TCU+ZG8FRKt1rjwcRzrzUZ67QoKuoFMVYg8LrstnFiuOpPydHkXlYtLJwgPVlmegASWAdYPvc4K2OWXRsJwzgyN+O0DWcUXlAyjCxpN/29hUV8WeaPjAnXkvce5ikVAw/wLSw+qx1PUEUWwNjwr4tpNcu9HC8FXws+FQKikvqu+QdJ3qork3u6oLOtZNrCjIsPo7WB0+qp0iJSnvU0UbJoBXohr4MLIYLDD9cGPDhOH6h6geJA9tnm2XXp94Pk6ri7jx/bhyFWS0IMAWhxRYbwladPiukvmlNJpPYi7KfC52Z8GVCCP3btMZ2n+T8Xt8GEbeoaZ82JOuVE9fgWeGGB2pLxMA="
    skip_cleanup: true
    on: # Set Deploy conditions
      # Deploy only when tag is not specified
      # tags: false
      # or this branch
      #branches:
      #   only:
      #     - master
      #     - master_1.5
      tags: true
      all_branches: true
      condition: "$TRAVIS_OS_NAME = linux"
      
  - provider: releases
    api_key:
      secure: "sOyAv1RJZZZ4+b4ATliFRtlTRLkDxlWekvxTqN9eY+HMV6YA9Vx2Gk47urmmYFN5mCxjXqZwOAiVIQNIZSIu6jtUW8A8yYEjVG800GTBq52WFjCmaRyC+IcRnRfoc9qtzlJSjLnn6uRNomQnuH1K8S2M7uMj4lmJTuP4akf2h7U2S735ducb4MdYlu9zvY/qjKx0voYVEPAuRA7eBF7zrbVwG3d8EOQUP2QK+RJTG4DF+SohCt2JH4yf+ACfcbF2qmRd3OIRcQZSaNyCbgG2+5iq2605kPZ3kSMtgx5LChCz0zTpBissPTfVL8q4009XlPlKgNxdnPvgKgk8Tbgx+dDJNKP+yzYabuV0+6UusZYHnzLegUTx5GHap+sRWUDdc2W6cyjzSYdjH3Cm18gPGekz6JRbSlCg9NKqwKfYhUYLeaPoW5lade2Popn0+hLFoTNPdu4uTVScmIcANsOmOQ50x5rlgEaXD9O5mCpkca0ig1/4HSA5fWQY/ATlKctUtY9IG96tRpEOXjz2LxxMELaNoOHIYJAojmy9SuxDBQHY5LVftj3QRIeGKhO3y7RA2XMy5cLCQY3z5I3goEhwNNsq/cWTvH8hyVLkAivyvZ5l/kHGsgyvcwiwwxaSc7fuo3DooypmFii5zOHUyUDZDSTnBrLIlH/UJjlaY33m8XQ="
    file_glob: true
    file: "$TRAVIS_BUILD_DIR/build/*.{deb,rpm,dmg,txz,pkg,pkg.tar.xz}"
    skip_cleanup: true
    on:
      all_branches: true
      tags: true
